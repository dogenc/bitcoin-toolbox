<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>DGKN Bitcoin Toolbox — Live Dashboard & HD-Scanner</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family:'IBM Plex Mono',monospace;
  background:#0b0f19;
  color:#e8eef8;
  margin:0;
  padding:0;
}

/* Bloomberg-Style Laufband oben */
#dashboard {
  position:fixed;
  top:0;left:0;right:0;
  z-index:9999;
  height:42px;
  background:linear-gradient(90deg,#111a2d,#1b2740);
  overflow:hidden;
  border-bottom:1px solid rgba(0,255,255,.2);
  box-shadow:0 2px 10px rgba(0,255,255,.1);
}
#ticker {
  display:inline-block;
  white-space:nowrap;
  animation:scrollTicker 40s linear infinite;
  color:#a6ebff;
  font-weight:600;
  font-size:15px;
  text-shadow:0 0 6px rgba(0,255,255,.25);
}
@keyframes scrollTicker {
  0%   { transform:translateX(100%); }
  100% { transform:translateX(-100%); }
}
#ticker span {
  margin:0 18px;
  transition:.3s;
}
.symbol {color:#ffb54a;font-weight:700;}
.chain  {color:#b4d4ff;}
.gear   {color:#9fc7ff;}
#priceUSD.up,#priceEUR.up {color:#3cff9e;text-shadow:0 0 8px #00ffaa;}
#priceUSD.down,#priceEUR.down {color:#ff7676;text-shadow:0 0 6px #ff5050;}

/* Hauptkarte */
.card{
  background:#111827;
  margin:80px auto 20px auto;
  padding:20px;
  border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,.6);
  max-width:1100px;
}
textarea,input,select{
  width:100%;
  padding:10px 12px;
  border-radius:8px;
  border:1px solid #2b3548;
  background:#1a2234;
  color:#f4f8ff;
  font-size:14px;
  box-sizing:border-box;
}
.row{display:flex;gap:8px;flex-wrap:wrap;}
.row>*{flex:1;min-width:100px;}
button{
  padding:9px 14px;
  border-radius:8px;
  background:#00adb5;
  border:none;
  color:#061418;
  font-weight:700;
  cursor:pointer;
  transition:background .2s ease;
}
button:hover{background:#05c2cc;}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:13px;}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;}
th{color:#9fd8ff;background:#1b2434;}
code{color:#b4e0ff;}
.ok{color:#8ef0ac;font-weight:700;}
.bad{color:#ff9b9b;font-weight:700;}
#txlist{margin-top:16px;font-size:13px;background:#0e1422;border-radius:8px;padding:10px 12px;}
#txlist th,#txlist td{border-bottom:1px solid rgba(255,255,255,.06);padding:6px 8px;}
#txlist th{color:#9fd8ff;background:#1a2234;}
#txlist td{color:#d8eaff;}
footer{
  margin-top:30px;
  font-size:12px;
  color:#7f9fb9;
  text-align:center;
  border-top:1px solid rgba(255,255,255,.08);
  padding:12px;
}
#btcSpinner{
  width:70px;
  height:70px;
  margin:40px auto 0 auto;
  background:url('https://upload.wikimedia.org/wikipedia/commons/4/46/Bitcoin.svg') center/contain no-repeat;
  animation:spin 5s linear infinite; /* schnellere Rotation */
  filter:drop-shadow(0 0 10px #ff9900);
  opacity:0.85;
}
@keyframes spin{0%{transform:rotateY(0deg);}100%{transform:rotateY(360deg);}}
</style>
</head>
<body>

<!-- Laufendes Bloomberg-Tickerband -->
<div id="dashboard">
  <div id="ticker">
    <span class="symbol">₿</span>
    <span id="priceUSD">--</span> USD · 
    <span id="priceEUR">--</span> EUR · 
    <span class="chain">⛓ Block</span> <span id="blockHeight">--</span> · 
    <span id="blockTime">--</span> ago · 
    <span class="gear">⚙</span> Scan <span id="scanStats">0 addr · 0 tx</span>
  </div>
</div>

<div class="card">
  <h1>Bitcoin Toolbox — Auto-Erkennung & HD-Scanner</h1>
  <textarea id="input" rows="3" placeholder="Bitcoin-Adresse (bc1..., 1..., 3...), xpub oder Seed-Phrase"></textarea>
  <div class="row" style="margin-top:8px">
    <select id="derivation">
      <option value="44">BIP44 (Legacy 1...)</option>
      <option value="49">BIP49 (P2SH-SegWit 3...)</option>
      <option value="84" selected>BIP84 (Bech32 bc1q...)</option>
      <option value="86">BIP86 (Taproot bc1p...)</option>
    </select>
    <input type="number" id="startIdx" min="0" value="0" placeholder="Startindex">
    <input type="number" id="count" min="1" value="5" placeholder="Anzahl Adressen">
  </div>
  <div style="margin-top:10px"><button id="scanBtn">Adressen & Salden abrufen</button></div>
  <div id="progress" style="margin-top:10px;color:#9fd8ff;"></div>
  <div id="result" style="margin-top:10px;overflow:auto;"></div>
  <div id="txlist"></div>
</div>

<div id="btcSpinner"></div>

<footer> © 2025 dgkn · Data via Blockstream & CoinGecko · 100 % client-side</footer>

<script src="https://cdn.jsdelivr.net/npm/bip39@3.0.4/dist/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.0/dist/bitcoinjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bip32@3.1.0/dist/index.min.js"></script>
<script>
(async function(){
  const priceUSD=document.getElementById('priceUSD');
  const priceEUR=document.getElementById('priceEUR');
  const blockHeight=document.getElementById('blockHeight');
  const blockTime=document.getElementById('blockTime');
  const scanStats=document.getElementById('scanStats');
  const scanBtn=document.getElementById('scanBtn');
  const resultEl=document.getElementById('result');
  const progressEl=document.getElementById('progress');
  const inputEl=document.getElementById('input');
  const derivSelect=document.getElementById('derivation');
  const txListEl=document.getElementById('txlist');

  async function updateDashboard(){
    try{
      const p=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd,eur');
      const d=await p.json();
      const nUSD=d.bitcoin.usd;const nEUR=d.bitcoin.eur;
      const oUSD=parseFloat(priceUSD.textContent)||nUSD;
      const trend=nUSD>oUSD?'up':(nUSD<oUSD?'down':'');
      priceUSD.textContent=nUSD.toLocaleString();
      priceEUR.textContent=nEUR.toLocaleString();
      priceUSD.className=trend;priceEUR.className=trend;
    }catch{}
    try{
      const h=await(await fetch('https://blockstream.info/api/blocks/tip/height')).text();
      const hash=await(await fetch('https://blockstream.info/api/blocks/tip/hash')).text();
      const blk=await(await fetch(`https://blockstream.info/api/block/${hash}`)).json();
      blockHeight.textContent=h;
      const ago=Math.floor(Date.now()/1000)-blk.timestamp;
      blockTime.textContent=ago<90?ago+' s':Math.round(ago/60)+' min';
    }catch{}
  }
  setInterval(updateDashboard,60000);
  updateDashboard();

  function looksLikeAddress(s){return /^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$/.test(s)||/^bc1[ac-hj-np-z02-9]{6,87}$/i.test(s);}
  function looksLikeXpub(s){return /^xpub|^ypub|^zpub/i.test(s.trim());}
  async function fetchBalance(a){const r=await fetch(`https://blockstream.info/api/address/${a}`);if(!r.ok)throw new Error('HTTP '+r.status);return await r.json();}
  async function fetchTxs(a){const r=await fetch(`https://blockstream.info/api/address/${a}/txs`);if(!r.ok)return[];return await r.json();}
  function satsToBtc(s){return (Number(s)/1e8).toFixed(8);}
  async function deriveAddresses(seedOrXpub,derivation,start,count){
    const b=window.bitcoinjs||window['bitcoinjs-lib'];
    const isX=looksLikeXpub(seedOrXpub);
    let root;
    if(isX){root=window.bip32.fromBase58(seedOrXpub.trim(),b.networks.bitcoin);}
    else{const seed=bip39.mnemonicToSeedSync(seedOrXpub.trim());root=window.bip32.fromSeed(seed,b.networks.bitcoin);}
    const p=derivation;const base=`m/${p}'/0'/0'/0`;
    const arr=[];
    for(let i=start;i<start+count;i++){
      const path=isX?`m/${i}`:`${base}/${i}`;
      const child=root.derivePath(path);
      const pub=child.publicKey;
      let adr;
      if(p==44) adr=b.payments.p2pkh({pubkey:pub}).address;
      if(p==49) adr=b.payments.p2sh({redeem:b.payments.p2wpkh({pubkey:pub})}).address;
      if(p==84) adr=b.payments.p2wpkh({pubkey:pub}).address;
      if(p==86) adr=b.payments.p2tr({internalPubkey:pub.slice(1,33)}).address;
      arr.push({index:i,address:adr});
    }
    return arr;
  }

  scanBtn.addEventListener('click',async()=>{
    const inp=inputEl.value.trim();
    if(!inp){alert('Bitte Eingabe machen.');return;}
    const deriv=derivSelect.value;
    const start=parseInt(document.getElementById('startIdx').value);
    const count=parseInt(document.getElementById('count').value);
    resultEl.innerHTML='';progressEl.textContent='';txListEl.innerHTML='';
    try{
      let addresses=[];
      if(looksLikeAddress(inp)){addresses=[{index:0,address:inp}];}
      else{progressEl.textContent='Adressen werden abgeleitet...';addresses=await deriveAddresses(inp,deriv,start,count);}
      progressEl.textContent='Blockchain-Abfragen laufen...';
      let total=0;let html='<table><tr><th>#</th><th>Adresse</th><th>Empfangen</th><th>Ausgegeben</th><th>Unspent</th><th>TXs</th></tr>';
      let allTxs=[];
      for(let i=0;i<addresses.length;i++){
        const a=addresses[i];
        progressEl.textContent=`Frage ${i+1}/${addresses.length}: ${a.address}`;
        try{
          const js=await fetchBalance(a.address);
          const funded=js.chain_stats?.funded_txo_sum??0;
          const spent=js.chain_stats?.spent_txo_sum??0;
          const txc=js.chain_stats?.tx_count??0;
          const unspent=funded-spent;
          total+=unspent;
          const txs=await fetchTxs(a.address);
          txs.forEach(tx=>allTxs.push({addr:a.address,id:tx.txid,value:(tx.vout?.reduce((s,v)=>s+v.value,0)||0)/1e8}));
          html+=`<tr><td>${a.index}</td><td><code>${a.address}</code></td><td>${satsToBtc(funded)}</td><td>${satsToBtc(spent)}</td><td>${satsToBtc(unspent)}</td><td>${txc}</td></tr>`;
          await new Promise(r=>setTimeout(r,200));
        }catch(e){html+=`<tr><td>${a.index}</td><td colspan="5" class="bad">Fehler bei ${a.address}</td></tr>`;}
      }
      html+=`</table><div style="margin-top:8px" class="ok">Gesamt: ${total.toLocaleString()} sats = ${satsToBtc(total)} BTC</div>`;
      resultEl.innerHTML=html;
      if(allTxs.length>0){
        let txHTML='<b>Verbundene Transaktionen:</b><table><tr><th>Adresse</th><th>TX-ID</th><th>Wert (BTC)</th></tr>';
        allTxs.forEach(t=>txHTML+=`<tr><td><code>${t.addr}</code></td><td>${t.id}</td><td>${t.value.toFixed(8)}</td></tr>`);
        txHTML+='</table>';txListEl.innerHTML=txHTML;
      }
      scanStats.textContent=`${addresses.length} addr · ${allTxs.length} tx`;
      progressEl.textContent='Fertig.';
    }catch(e){progressEl.textContent='Fehler: '+e.message;}
  });
})();
</script>
</body>
</html>
